function resizeCanvas(){var e=window.innerWidth,r=window.innerHeight-10;centerX=e/2,centerY=r/2,drawCanvas(e,r),updateDrumNumber()}function drawCanvas(e,r){stage=new Kinetic.Stage({container:"container",width:e,height:r});var a=new Kinetic.Layer,n=new Kinetic.Circle({x:centerX,y:centerY,radius:40,fill:"grey",stroke:"white",strokeWidth:2});a.on("click touchstart",function(){togglePlay()}),a.on("mouseover",function(){document.body.style.cursor="pointer",n.fill("black"),a.draw()}),a.on("mouseout",function(){document.body.style.cursor="default",n.fill("grey"),a.draw()}),a.add(n),imageObj=new Image,imageObj.onload=function(){var e=new Kinetic.Image({x:centerX-16,y:centerY-16,image:imageObj,width:32,height:32});a.add(e),a.draw()},imageObj.src="img/play_64.png",stage.add(a),clockHandLayer=new Kinetic.Layer,clockHand=new Kinetic.Arc({x:stage.width()/2,y:stage.height()/2,innerRadius:42,outerRadius:65+arcWidth*numberOfDrums,fillLinearGradientStartPoint:{x:0,y:0},fillLinearGradientEndPoint:{x:0,y:80},fillLinearGradientColorStops:[0,"#26294a",1,"white"],angle:22.5,rotationDeg:247.5}),clockHandLayer.add(clockHand),stage.add(clockHandLayer),anim=new Kinetic.Animation(function(e){var r=e.timeDiff*angularSpeed/1e3;clockHand.rotate(r)},clockHandLayer);for(var t=0;8>t;t+=1)drawDrumLayer(t)}function drawDrumLayer(e){layers[e]&&layers[e].destroy(),layers[e]=new Kinetic.Layer;for(var r=360/barDivisions[e],a=0;a<barDivisions[e];a+=1)drumArcs[e][a]=new Kinetic.Arc({x:stage.width()/2,y:stage.height()/2,innerRadius:65+arcWidth*e,outerRadius:65+arcWidth+arcWidth*e,fill:drumColours[e][0],stroke:"#26294a",strokeWidth:2,angle:r,opacity:.8,rotationDeg:(270+r*a)%360}),1===drumPattern[e][a]&&drumArcs[e][a].fill(drumColours[e][1]),drumArcs[e][a].on("click touchstart",function(){for(var r,a=0;a<drumArcs.length;a+=1)if(-1!==drumArcs[a].indexOf(this)){r=a;break}var n=drumArcs[r].indexOf(this);0===drumPattern[r][n]?(this.fill(drumColours[r][1]),drumPattern[r][n]=1):1===drumPattern[r][n]&&(this.fill(drumColours[r][0]),drumPattern[r][n]=0),console.log(drumPattern[r][n]),layers[e].draw()}),layers[e].add(drumArcs[e][a]);stage.add(layers[e])}function redrawDrumLayer(e,r){barDivisions[r]=e.value,drawDrumLayer(r)}function updateDrumNumber(){var e=$("#template").html(),r=$("#individualDrumSettings");numberOfDrums=$("#drumCount").val(),Mustache.parse(e),r.empty();for(var a=1;numberOfDrums>=a;a+=1){r.append(Mustache.render(e,{num:a,arrayNum:a-1}));var n="#drum"+a+"Sample";$(n).val(samples[a-1])}for(var t=0;8>t;t+=1)numberOfDrums>t?layers[t].show():layers[t].hide();clockHand.outerRadius(65+arcWidth*numberOfDrums),clockHandLayer.draw()}for(var canvas=null,context=null,stage=null,centerX,centerY,layers=[],clockHandLayer,clockHand,imageObj,numberOfDrums=6,arcWidth=30,anim,drumArcs=[];drumArcs.length<10;drumArcs.push([]));var drumPattern=[[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],barDivisions=[16,16,16,16,16,16,16,16],drumColours=[["#e2bfce","#a12a5e"],["#f9b3c7","#ed0345"],["#fad2c1","#ef6a32"],["#fdebc7","#fbbf45"],["#e5f3cf","#aad962"],["#b3edd9","#03c383"],["#b2d5ca","#017351"],["#b2cbcd","#01545a"]];window.addEventListener("resize",resizeCanvas,!1),$("#tempo").change(function(){tempo=$(this).val()}),$("#options-toggle").click(function(e){e.preventDefault(),$("#controls").toggle()}),$(document).ready(function(){resizeCanvas(),$("#drumCount").change(updateDrumNumber),$("#dismiss-alert").click(function(){$("#alert").slideToggle(500)})});