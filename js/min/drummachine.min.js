function init(){loadSoundFile(samples[0],0),loadSoundFile(samples[1],1),loadSoundFile(samples[2],2),loadSoundFile(samples[3],3),loadSoundFile(samples[4],4)}function loadSoundFile(e,a){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){initSound(this.response,a)},n.send()}function initSound(e,a){context.decodeAudioData(e,function(e){drumBuffers[a]=e,console.log("sampleLoaded")},function(e){console.log("Error decoding file",e)})}function playDrum(e,a){source=context.createBufferSource(),source.buffer=drumBuffers[a],source.loop=!1,source.connect(context.destination),source.start(e),console.log("playing drum number: "+a)}function togglePlay(){var e=context.currentTime;playing===!1?(playing=!0,nextBarStartTime=e,scheduler(),anim.start(),imageObj.src="img/stop_64.png"):(playing=!1,window.clearTimeout(timerID),setTimeout(function(){anim.stop(),clockHand.rotation(247.5),clockHandLayer.draw(),imageObj.src="img/play_64.png"},1e3*(nextBarStartTime-e)))}function scheduler(){for(;nextBarStartTime<context.currentTime+.1;)scheduleNextBar();timerID=window.setTimeout(scheduler,100)}function scheduleNextBar(){barTime=240/tempo,angularSpeed=360/barTime;for(var e=0;numberOfDrums>e;e+=1)for(var a=0;a<barDivisions[e];a+=1)1===drumPattern[e][a]&&playDrum(nextBarStartTime+a*(barTime/barDivisions[e]),e);nextBarStartTime+=barTime}function changeDrumSample(e,a){samples[a]=e.value,loadSoundFile(samples[a],a)}var context=new AudioContext,tempo=120,barTime=240/tempo,angularSpeed=360/barTime,drumBuffers=[],playing=!1,nextBarStartTime,timerID=null,samples=["samples/808 Kick.wav","samples/808 Snare.wav","samples/808 Closed Hihat.wav","samples/808 Clap.wav","samples/808 Mid Tom.wav"];init();